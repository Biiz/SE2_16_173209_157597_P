<!DOCTYPE html>
<html>
<head>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.5.1.js" type="text/javascript"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.10/jquery-ui.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
            crossorigin="anonymous">
    </script>

    <link   rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
            integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
            crossorigin="anonymous">

    <script type="text/javascript">

        var count_request = 7;
        var offset_request = 0;
        (function($) {
            $.bingSearch = function(option) {
                let bingApiUrl = 'https://api.cognitive.microsoft.com/bing/v5.0/search';
                var options = $.extend({
                    'keyword': '',
                    'apiKey': '5f793a06f6124a029b96506e9a009461',
                }, option || {});
                $.ajax({
                    url: bingApiUrl,
                    data: {
                        //preimposto che cercherò su SanMartino
                        'q': "site:www.sanmartino.com " + options.keyword,
                        count: count_request,
                        offset: offset_request,
                        //customconfig: 1447398313,
                    },
                    headers: {
                        'Ocp-Apim-Subscription-Key': options.apiKey
                    },
                    success: function(response) {
                        if ($.isFunction(options.onSuccess)) {
                            options.onSuccess.call(this, response);
                        }
                    },
                    error: function(response) {
                        console.log(response.responseJSON);
                        return;
                    }
                });
            }
        })(jQuery);
    </script>

    <script type="text/javascript">
        
        $(function() {
            $('#find').click(function() {
                $.bingSearch({
                    apiKey: '5f793a06f6124a029b96506e9a009461',
                    keyword: $('#keyword').val(),
                    
                    //inserisce nel DIV i valori trovati
                    onSuccess: function(response) {
                        $('.result').empty();
                        var data = response.webPages.value;
                        $('.result').html('');
                        count = 0;
                        var idNumber = 0;
                        for (var i = 0; i < data.length; i++) {
                            //divido gli ID così da gestire la paginazione
                            if(count == 7) {
                                count = 0;
                                idNumber++;
                            }
                            else{count++;}    

                            var situs = data[i];
                            //il risultato della ricerca
                            var obj_lista = '<div class="siteList" id="' + idNumber + '">' +
                                            '   <h4><a href="' + situs.url + '" target="_blank">' + situs.name + '</a></h4>' +
                                            '   <h5><span class="displayUrl">' + situs.displayUrl + '</span></h5>' +
                                                situs.snippet +
                                            '</div>';

                            $('.result').append(obj_lista);
                        }
                        //gestione visibilità bottoni, dipende dal numero di risultati ottenuti
                        if(count < 6) {
                            $("#succ").prop("disabled",true);
                            if(offset_request <7) $("#prec").prop("disabled",true);
                        }else{
                            $("#succ").prop("disabled",false);
                        }
                    }
                });
            });
        })

        var count = 0;

        function paginaSucc(){
            offset_request += 7;
            $("#find").click();
            $("#prec").prop("disabled",false);
        }

        function paginaPrec(){
            offset_request -= 7;
            if(offset_request<=0) {
                offset_request=0;
                $("#prec").prop("disabled",true);
            }
            $("#find").click();
        }

    </script>

    <style type="text/css">
        .siteList {
            padding: 5px;
            margin: 10px;  
        }
        .siteList:hover {
            -webkit-box-shadow:inset 0px 0px 0px 1px #f00;
            -moz-box-shadow:inset 0px 0px 0px 1px #f00;
            box-shadow:inset 0px 0px 0px 1px #f00;  
        }
        .siteList a {
            color: red;
        }
        .siteList .displayUrl {
            color: #696969;
        }
        .hidden{
            display: none;
        }
    </style>
</head>

<body>
    <div class="row center-text" style="margin: 20px">
        <div class="col-lg-12">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search for..." id="keyword">
                <span class="input-group-btn">
                    <button class="btn btn-danger" type="button" id="find">GO</button>
                </span>
            </div>
        </div>
    </div>

    <div class="row center-text" style="margin: 20px">
        <div class="col-lg-12">
            <br/>
            <!-- contiene i risultati della ricerca -->
            <div class="result"></div>
            <br/>
            <button class="btn btn-default btn-small" onclick="paginaPrec()" id="prec" disabled> precedente</button>
            <button class="btn btn-default btn-small" onclick="paginaSucc()" id="succ" disabled> successiva</button>
        </div>
    </div>


</body>


</html>
